var pe=t=>{throw TypeError(t)};var Y=(t,e,s)=>e.has(t)||pe("Cannot "+s);var i=(t,e,s)=>(Y(t,e,"read from private field"),s?s.call(t):e.get(t)),g=(t,e,s)=>e.has(t)?pe("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,s),d=(t,e,s,r)=>(Y(t,e,"write to private field"),r?r.call(t,s):e.set(t,s),s),p=(t,e,s)=>(Y(t,e,"access private method"),s);import{S as Qe,p as me,r as w,s as J,a as V,n as Ne,i as Z,b as xe,t as De,f as Me,c as Pe,d as ge,e as je,g as I,u as Fe,h as Ue,R as T,j as a,k as Be,C as Le,l as _e,m as ze,A as Ge,o as ke,q as Ae,B as He,v as $e,w as qe}from"./index-BmL7ZD0X.js";import{s as Ve,n as be}from"./utils-km2FGkQ4.js";import{B as Se,S as We,a as Xe,b as Ke,c as Ye,d as Je,L as Ze}from"./sheet-DWk6hkkl.js";var j,c,H,R,P,_,D,E,$,z,G,F,U,M,k,u,A,ee,te,se,re,ie,ae,ne,Ee,Re,et=(Re=class extends Qe{constructor(e,s){super();g(this,u);g(this,j);g(this,c);g(this,H);g(this,R);g(this,P);g(this,_);g(this,D);g(this,E);g(this,$);g(this,z);g(this,G);g(this,F);g(this,U);g(this,M);g(this,k,new Set);this.options=s,d(this,j,e),d(this,E,null),d(this,D,me()),this.options.experimental_prefetchInRender||i(this,D).reject(new Error("experimental_prefetchInRender feature flag is not enabled")),this.bindMethods(),this.setOptions(s)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(i(this,c).addObserver(this),ye(i(this,c),this.options)?p(this,u,A).call(this):this.updateResult(),p(this,u,re).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return oe(i(this,c),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return oe(i(this,c),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,p(this,u,ie).call(this),p(this,u,ae).call(this),i(this,c).removeObserver(this)}setOptions(e,s){const r=this.options,n=i(this,c);if(this.options=i(this,j).defaultQueryOptions(e),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof w(this.options.enabled,i(this,c))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");p(this,u,ne).call(this),i(this,c).setOptions(this.options),r._defaulted&&!J(this.options,r)&&i(this,j).getQueryCache().notify({type:"observerOptionsUpdated",query:i(this,c),observer:this});const o=this.hasListeners();o&&Ce(i(this,c),n,this.options,r)&&p(this,u,A).call(this),this.updateResult(s),o&&(i(this,c)!==n||w(this.options.enabled,i(this,c))!==w(r.enabled,i(this,c))||V(this.options.staleTime,i(this,c))!==V(r.staleTime,i(this,c)))&&p(this,u,ee).call(this);const l=p(this,u,te).call(this);o&&(i(this,c)!==n||w(this.options.enabled,i(this,c))!==w(r.enabled,i(this,c))||l!==i(this,M))&&p(this,u,se).call(this,l)}getOptimisticResult(e){const s=i(this,j).getQueryCache().build(i(this,j),e),r=this.createResult(s,e);return st(this,r)&&(d(this,R,r),d(this,_,this.options),d(this,P,i(this,c).state)),r}getCurrentResult(){return i(this,R)}trackResult(e,s){const r={};return Object.keys(e).forEach(n=>{Object.defineProperty(r,n,{configurable:!1,enumerable:!0,get:()=>(this.trackProp(n),s==null||s(n),e[n])})}),r}trackProp(e){i(this,k).add(e)}getCurrentQuery(){return i(this,c)}refetch({...e}={}){return this.fetch({...e})}fetchOptimistic(e){const s=i(this,j).defaultQueryOptions(e),r=i(this,j).getQueryCache().build(i(this,j),s);return r.fetch().then(()=>this.createResult(r,s))}fetch(e){return p(this,u,A).call(this,{...e,cancelRefetch:e.cancelRefetch??!0}).then(()=>(this.updateResult(),i(this,R)))}createResult(e,s){var fe;const r=i(this,c),n=this.options,o=i(this,R),l=i(this,P),y=i(this,_),x=e!==r?e.state:i(this,H),{state:C}=e;let h={...C},b=!1,f;if(s._optimisticResults){const v=this.hasListeners(),B=!v&&ye(e,s),L=v&&Ce(e,r,s,n);(B||L)&&(h={...h,...Pe(C.data,e.options)}),s._optimisticResults==="isRestoring"&&(h.fetchStatus="idle")}let{error:Q,errorUpdatedAt:N,status:O}=h;if(s.select&&h.data!==void 0)if(o&&h.data===(l==null?void 0:l.data)&&s.select===i(this,$))f=i(this,z);else try{d(this,$,s.select),f=s.select(h.data),f=ge(o==null?void 0:o.data,f,s),d(this,z,f),d(this,E,null)}catch(v){d(this,E,v)}else f=h.data;if(s.placeholderData!==void 0&&f===void 0&&O==="pending"){let v;if(o!=null&&o.isPlaceholderData&&s.placeholderData===(y==null?void 0:y.placeholderData))v=o.data;else if(v=typeof s.placeholderData=="function"?s.placeholderData((fe=i(this,G))==null?void 0:fe.state.data,i(this,G)):s.placeholderData,s.select&&v!==void 0)try{v=s.select(v),d(this,E,null)}catch(B){d(this,E,B)}v!==void 0&&(O="success",f=ge(o==null?void 0:o.data,v,s),b=!0)}i(this,E)&&(Q=i(this,E),f=i(this,z),N=Date.now(),O="error");const W=h.fetchStatus==="fetching",X=O==="pending",K=O==="error",ue=X&&W,de=f!==void 0,S={status:O,fetchStatus:h.fetchStatus,isPending:X,isSuccess:O==="success",isError:K,isInitialLoading:ue,isLoading:ue,data:f,dataUpdatedAt:h.dataUpdatedAt,error:Q,errorUpdatedAt:N,failureCount:h.fetchFailureCount,failureReason:h.fetchFailureReason,errorUpdateCount:h.errorUpdateCount,isFetched:h.dataUpdateCount>0||h.errorUpdateCount>0,isFetchedAfterMount:h.dataUpdateCount>x.dataUpdateCount||h.errorUpdateCount>x.errorUpdateCount,isFetching:W,isRefetching:W&&!X,isLoadingError:K&&!de,isPaused:h.fetchStatus==="paused",isPlaceholderData:b,isRefetchError:K&&de,isStale:ce(e,s),refetch:this.refetch,promise:i(this,D)};if(this.options.experimental_prefetchInRender){const v=q=>{S.status==="error"?q.reject(S.error):S.data!==void 0&&q.resolve(S.data)},B=()=>{const q=d(this,D,S.promise=me());v(q)},L=i(this,D);switch(L.status){case"pending":e.queryHash===r.queryHash&&v(L);break;case"fulfilled":(S.status==="error"||S.data!==L.value)&&B();break;case"rejected":(S.status!=="error"||S.error!==L.reason)&&B();break}}return S}updateResult(e){const s=i(this,R),r=this.createResult(i(this,c),this.options);if(d(this,P,i(this,c).state),d(this,_,this.options),i(this,P).data!==void 0&&d(this,G,i(this,c)),J(r,s))return;d(this,R,r);const n={},o=()=>{if(!s)return!0;const{notifyOnChangeProps:l}=this.options,y=typeof l=="function"?l():l;if(y==="all"||!y&&!i(this,k).size)return!0;const m=new Set(y??i(this,k));return this.options.throwOnError&&m.add("error"),Object.keys(i(this,R)).some(x=>{const C=x;return i(this,R)[C]!==s[C]&&m.has(C)})};(e==null?void 0:e.listeners)!==!1&&o()&&(n.listeners=!0),p(this,u,Ee).call(this,{...n,...e})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&p(this,u,re).call(this)}},j=new WeakMap,c=new WeakMap,H=new WeakMap,R=new WeakMap,P=new WeakMap,_=new WeakMap,D=new WeakMap,E=new WeakMap,$=new WeakMap,z=new WeakMap,G=new WeakMap,F=new WeakMap,U=new WeakMap,M=new WeakMap,k=new WeakMap,u=new WeakSet,A=function(e){p(this,u,ne).call(this);let s=i(this,c).fetch(this.options,e);return e!=null&&e.throwOnError||(s=s.catch(Ne)),s},ee=function(){p(this,u,ie).call(this);const e=V(this.options.staleTime,i(this,c));if(Z||i(this,R).isStale||!xe(e))return;const r=De(i(this,R).dataUpdatedAt,e)+1;d(this,F,setTimeout(()=>{i(this,R).isStale||this.updateResult()},r))},te=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(i(this,c)):this.options.refetchInterval)??!1},se=function(e){p(this,u,ae).call(this),d(this,M,e),!(Z||w(this.options.enabled,i(this,c))===!1||!xe(i(this,M))||i(this,M)===0)&&d(this,U,setInterval(()=>{(this.options.refetchIntervalInBackground||Me.isFocused())&&p(this,u,A).call(this)},i(this,M)))},re=function(){p(this,u,ee).call(this),p(this,u,se).call(this,p(this,u,te).call(this))},ie=function(){i(this,F)&&(clearTimeout(i(this,F)),d(this,F,void 0))},ae=function(){i(this,U)&&(clearInterval(i(this,U)),d(this,U,void 0))},ne=function(){const e=i(this,j).getQueryCache().build(i(this,j),this.options);if(e===i(this,c))return;const s=i(this,c);d(this,c,e),d(this,H,e.state),this.hasListeners()&&(s==null||s.removeObserver(this),e.addObserver(this))},Ee=function(e){je.batch(()=>{e.listeners&&this.listeners.forEach(s=>{s(i(this,R))}),i(this,j).getQueryCache().notify({query:i(this,c),type:"observerResultsUpdated"})})},Re);function tt(t,e){return w(e.enabled,t)!==!1&&t.state.data===void 0&&!(t.state.status==="error"&&e.retryOnMount===!1)}function ye(t,e){return tt(t,e)||t.state.data!==void 0&&oe(t,e,e.refetchOnMount)}function oe(t,e,s){if(w(e.enabled,t)!==!1){const r=typeof s=="function"?s(t):s;return r==="always"||r!==!1&&ce(t,e)}return!1}function Ce(t,e,s,r){return(t!==e||w(r.enabled,t)===!1)&&(!s.suspense||t.state.status!=="error")&&ce(t,s)}function ce(t,e){return w(e.enabled,t)!==!1&&t.isStaleByTime(V(e.staleTime,t))}function st(t,e){return!J(t.getCurrentResult(),e)}var we=I.createContext(!1),rt=()=>I.useContext(we);we.Provider;function it(){let t=!1;return{clearReset:()=>{t=!1},reset:()=>{t=!0},isReset:()=>t}}var at=I.createContext(it()),nt=()=>I.useContext(at),ot=(t,e)=>{(t.suspense||t.throwOnError||t.experimental_prefetchInRender)&&(e.isReset()||(t.retryOnMount=!1))},ct=t=>{I.useEffect(()=>{t.clearReset()},[t])},ht=({result:t,errorResetBoundary:e,throwOnError:s,query:r})=>t.isError&&!e.isReset()&&!t.isFetching&&r&&Ve(s,[t.error,r]),lt=t=>{const e=t.staleTime;t.suspense&&(t.staleTime=typeof e=="function"?(...s)=>Math.max(e(...s),1e3):Math.max(e??1e3,1e3),typeof t.gcTime=="number"&&(t.gcTime=Math.max(t.gcTime,1e3)))},ut=(t,e)=>t.isLoading&&t.isFetching&&!e,dt=(t,e)=>(t==null?void 0:t.suspense)&&e.isPending,ve=(t,e,s)=>e.fetchOptimistic(t).catch(()=>{s.clearReset()});function ft(t,e,s){var C,h,b,f,Q;const r=Fe(),n=rt(),o=nt(),l=r.defaultQueryOptions(t);(h=(C=r.getDefaultOptions().queries)==null?void 0:C._experimental_beforeQuery)==null||h.call(C,l),l._optimisticResults=n?"isRestoring":"optimistic",lt(l),ot(l,o),ct(o);const y=!r.getQueryCache().get(l.queryHash),[m]=I.useState(()=>new e(r,l)),x=m.getOptimisticResult(l);if(I.useSyncExternalStore(I.useCallback(N=>{const O=n?be:m.subscribe(je.batchCalls(N));return m.updateResult(),O},[m,n]),()=>m.getCurrentResult(),()=>m.getCurrentResult()),I.useEffect(()=>{m.setOptions(l,{listeners:!1})},[l,m]),dt(l,x))throw ve(l,m,o);if(ht({result:x,errorResetBoundary:o,throwOnError:l.throwOnError,query:r.getQueryCache().get(l.queryHash)}))throw x.error;if((f=(b=r.getDefaultOptions().queries)==null?void 0:b._experimental_afterQuery)==null||f.call(b,l,x),l.experimental_prefetchInRender&&!Z&&ut(x,n)){const N=y?ve(l,m,o):(Q=r.getQueryCache().get(l.queryHash))==null?void 0:Q.promise;N==null||N.catch(be).finally(()=>{m.updateResult()})}return l.notifyOnChangeProps?x:m.trackResult(x)}function pt(t,e){return ft(t,et)}const Oe=t=>pt({queryKey:["getGithubCards"],queryFn:()=>Ue({config:t==null?void 0:t.config}),...t==null?void 0:t.options}),mt=(t,e)=>{const s=new Map;let r;return function(...n){s.has(n[0])&&(clearTimeout(s.get(n[0])),s.delete(n[0])),r=setTimeout(()=>t(...n),e),s.set(n[0],r)}},Ie=T.createContext({select:{id:null,offset:{x:0,y:0}},setSelect:()=>{}}),xt=({children:t})=>{const[e,s]=T.useState({id:null,offset:{x:0,y:0}}),r=T.useMemo(()=>({select:e,setSelect:s}),[e]);return a.jsx(Ie.Provider,{value:r,children:t})},he=()=>T.useContext(Ie),Te=T.createContext({cardEntires:{},getById:()=>({}),setCardEntires:()=>{},incrementReaction:()=>{},positionChange:()=>{}}),gt=({children:t,defaultCardEntires:e})=>{const{select:s}=he(),[r,n]=T.useState(e),o=h=>r[h],l=(h,b)=>Be({params:{...b,id:h}}),y=T.useMemo(()=>mt(l,500),[]),m=h=>{if(!s.id)return;const b=o(s.id),f={...b,position:{x:h.x+s.offset.x-b.size.width/2,y:h.y+s.offset.y-b.size.height/2}};n({...r,[s.id]:f}),y(s.id,f)},x=(h,b)=>{const f=o(h),Q={...f,reactions:{...f.reactions,[b]:f.reactions[b]+1}};n({...r,[h]:Q}),y(h,Q)},C=T.useMemo(()=>({cardEntires:r,setCardEntires:n,getById:o,incrementReaction:x,positionChange:m}),[r]);return a.jsx(Te.Provider,{value:C,children:t})},le=()=>T.useContext(Te),bt=t=>{const{setSelect:e}=he(),{getById:s,setCardEntires:r,cardEntires:n,incrementReaction:o,positionChange:l}=le(),y=s(t);return{state:{card:y},functions:{setDragging:(x,C={x:0,y:0})=>{r({...n,[t]:{...y,isDragging:x}}),e({id:x?t:null,offset:C})},incrementReaction:o,positionChange:l}}},yt=({id:t})=>{const{state:e,functions:s}=bt(t);return a.jsxs(Le,{style:{zIndex:e.card.isDragging?50:1,cursor:"pointer",left:`${e.card.position.x}px`,top:`${e.card.position.y}px`,width:`${e.card.size.width}px`,height:`${e.card.size.height}px`,position:"absolute",userSelect:"none"},onMouseDown:r=>s.setDragging(!0,{x:e.card.position.x-r.clientX+e.card.size.width/2,y:e.card.position.y-r.clientY+e.card.size.height/2}),onMouseMove:r=>s.positionChange({y:r.clientY,x:r.clientX}),onMouseUp:()=>s.setDragging(!1),children:[a.jsxs(_e,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[a.jsx(ze,{className:"text-sm font-medium",children:e.card.id}),a.jsx(Ge,{className:"h-10 w-10",children:a.jsx(ke,{alt:e.card.title,src:e.card.image})})]}),a.jsxs(Ae,{children:[a.jsx("div",{className:"text-md font-bold",children:e.card.title}),a.jsx("p",{className:"text-xs text-muted-foreground",children:e.card.description}),a.jsx("div",{className:"my-2 flex gap-2",children:Object.entries(e.card.reactions).map(([r,n])=>a.jsxs(Se,{variant:"outline",onClick:o=>{o.stopPropagation(),s.incrementReaction(e.card.id,r)},children:[r," ",n]},r))}),a.jsxs("div",{className:"flex gap-2",children:[a.jsxs("div",{children:["x: ",e.card.position.x]}),a.jsxs("div",{children:["y: ",e.card.position.y]})]})]})]})},Ct=({id:t})=>{const{getById:e,incrementReaction:s}=le(),r=e(t);return a.jsxs("div",{className:"my-2 flex gap-2",children:[r.title,Object.entries(r.reactions).map(([n,o])=>a.jsxs(Se,{className:"cursor-pointer select-none",variant:"outline",onClick:()=>s(r.id,n),children:[n," ",o]},n))]})},vt=()=>{const{cardEntires:t}=le(),e=Object.values(t).reduce((s,r)=>s+Object.values(r.reactions).reduce((n,o)=>n+o,0),0);return a.jsxs("p",{className:"text-sm",children:["reactions count: ",a.jsx("b",{children:e})]})},Rt=()=>{const t=Oe(),{select:e}=he();return a.jsxs("div",{className:"absolute left-5 top-20",children:[a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-2xl font-medium",children:"Github cards"}),a.jsx(vt,{})]}),a.jsxs(We,{children:[a.jsx(Xe,{children:a.jsx(He,{children:"Open"})}),a.jsx(Ke,{className:"flex justify-center overflow-y-auto p-4 sm:max-w-[450px]",children:a.jsxs(Ye,{children:[a.jsx(Je,{children:"Cards"}),a.jsx("div",{className:"flex flex-col gap-2",children:t.data.data.githubCards.map(s=>a.jsx(Ct,{id:s.id},s.id))})]})})]})]}),e.id&&a.jsxs("p",{className:"text-sm",children:["selected: ",a.jsx("b",{children:e.id})]})]})},jt=({children:t,cardEntries:e})=>a.jsx(xt,{children:a.jsx(gt,{...e,children:t})}),St=()=>{const t=Oe();if(t.isPending||!t.data)return a.jsx("div",{className:"relative h-screen w-full",children:a.jsx("div",{className:"flex h-full items-center justify-center",children:a.jsx(Ze,{className:"size-6 animate-spin"})})});const e=t.data.data.githubCards,s=e.reduce((r,n)=>({...r,[n.id]:{...n,isDragging:!1}}),{});return a.jsxs(jt,{cardEntries:{defaultCardEntires:s},children:[a.jsx("div",{className:"relative h-screen w-full",children:e.map(r=>a.jsx(yt,{id:r.id},r.id))}),!!e.length&&a.jsx(Rt,{})]})},Qt=$e(qe.GITHUB_CONTEXT)({component:St});export{Qt as Route};
