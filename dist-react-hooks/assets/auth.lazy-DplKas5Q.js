var ze=e=>{throw TypeError(e)};var Oe=(e,t,a)=>t.has(e)||ze("Cannot "+a);var I=(e,t,a)=>(Oe(e,t,"read from private field"),a?a.call(e):t.get(e)),te=(e,t,a)=>t.has(e)?ze("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,a),ne=(e,t,a,r)=>(Oe(e,t,"write to private field"),r?r.call(e,a):t.set(e,a),a),ae=(e,t,a)=>(Oe(e,t,"access private method"),a);import{S as It,s as Et,V as Ge,W as Ot,e as Ze,u as Tt,g as F,Y as ce,I as Ft,Z as At,j as n,B as L,_ as Y,$ as Pt,a0 as kt,R as E,a1 as Ae,a2 as Te,a3 as Mt,a4 as se,a5 as R,a6 as et,a7 as Ne,a8 as tt,a9 as nt,w as Me,aa as Re,ab as Ce,ac as V,ad as D,ae as U,af as B,ag as ge,ah as _,ai as Rt,aj as We,ak as Ut,al as Q,am as Vt,an as Dt,J as qe,ao as $e,ap as Bt,aq as _t,ar as Lt,as as Kt,at as zt,au as Gt,av as Wt,aw as He,v as qt}from"./index-BmL7ZD0X.js";import{S as re,u as at,a as rt,I as S}from"./skeleton-m1_nhjo3.js";import{n as $t,s as Ht}from"./utils-km2FGkQ4.js";var $,H,M,z,G,ve,Pe,Qe,Yt=(Qe=class extends It{constructor(t,a){super();te(this,G);te(this,$);te(this,H);te(this,M);te(this,z);ne(this,$,t),this.setOptions(a),this.bindMethods(),ae(this,G,ve).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){var r;const a=this.options;this.options=I(this,$).defaultMutationOptions(t),Et(this.options,a)||I(this,$).getMutationCache().notify({type:"observerOptionsUpdated",mutation:I(this,M),observer:this}),a!=null&&a.mutationKey&&this.options.mutationKey&&Ge(a.mutationKey)!==Ge(this.options.mutationKey)?this.reset():((r=I(this,M))==null?void 0:r.state.status)==="pending"&&I(this,M).setOptions(this.options)}onUnsubscribe(){var t;this.hasListeners()||(t=I(this,M))==null||t.removeObserver(this)}onMutationUpdate(t){ae(this,G,ve).call(this),ae(this,G,Pe).call(this,t)}getCurrentResult(){return I(this,H)}reset(){var t;(t=I(this,M))==null||t.removeObserver(this),ne(this,M,void 0),ae(this,G,ve).call(this),ae(this,G,Pe).call(this)}mutate(t,a){var r;return ne(this,z,a),(r=I(this,M))==null||r.removeObserver(this),ne(this,M,I(this,$).getMutationCache().build(I(this,$),this.options)),I(this,M).addObserver(this),I(this,M).execute(t)}},$=new WeakMap,H=new WeakMap,M=new WeakMap,z=new WeakMap,G=new WeakSet,ve=function(){var a;const t=((a=I(this,M))==null?void 0:a.state)??Ot();ne(this,H,{...t,isPending:t.status==="pending",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset})},Pe=function(t){Ze.batch(()=>{var a,r,s,o,i,c,m,h;if(I(this,z)&&this.hasListeners()){const g=I(this,H).variables,y=I(this,H).context;(t==null?void 0:t.type)==="success"?((r=(a=I(this,z)).onSuccess)==null||r.call(a,t.data,g,y),(o=(s=I(this,z)).onSettled)==null||o.call(s,t.data,null,g,y)):(t==null?void 0:t.type)==="error"&&((c=(i=I(this,z)).onError)==null||c.call(i,t.error,g,y),(h=(m=I(this,z)).onSettled)==null||h.call(m,void 0,t.error,g,y))}this.listeners.forEach(g=>{g(I(this,H))})})},Qe);function ue(e,t){const a=Tt(),[r]=F.useState(()=>new Yt(a,e));F.useEffect(()=>{r.setOptions(e)},[r,e]);const s=F.useSyncExternalStore(F.useCallback(i=>r.subscribe(Ze.batchCalls(i)),[r]),()=>r.getCurrentResult(),()=>r.getCurrentResult()),o=F.useCallback((i,c)=>{r.mutate(i,c).catch($t)},[r]);if(s.error&&Ht(r.options.throwOnError,[s.error]))throw s.error;return{...s,mutate:o,mutateAsync:s.mutate}}const Xt=({params:e,config:t})=>ce.post("otp/email",e,t),Jt=({params:e,config:t})=>ce.post("otp/phone",e,t),Qt=({params:e,config:t})=>ce.post("signin/login",e,t),Zt=({params:e,config:t})=>ce.post("signup",e,t),en=({params:e,config:t})=>ce.post("twoFactorAuthentication",e,t);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tn=Ft("ChevronsUpDown",[["path",{d:"m7 15 5 5 5-5",key:"1hf1tw"}],["path",{d:"m7 9 5-5 5 5",key:"sgt6xg"}]]),Ue=e=>ue({mutationKey:["postOtpEmail"],mutationFn:({params:t,config:a})=>Xt({params:t,config:{...e==null?void 0:e.config,...a}}),...e==null?void 0:e.options}),st=e=>ue({mutationKey:["postOtpPhone"],mutationFn:({params:t,config:a})=>Jt({params:t,config:{...e==null?void 0:e.config,...a}}),...e==null?void 0:e.options}),nn=e=>ue({mutationKey:["postSignInLogin"],mutationFn:({params:t,config:a})=>Qt({params:t,config:{...e==null?void 0:e.config,...a}}),...e==null?void 0:e.options}),an=e=>ue({mutationKey:["postSignUp"],mutationFn:({params:t,config:a})=>Zt({params:t,config:{...e==null?void 0:e.config,...a}}),...e==null?void 0:e.options}),rn=e=>ue({mutationKey:["twoFactorAuthentication"],mutationFn:({params:t,config:a})=>en({params:t,config:{...e==null?void 0:e.config,...a}}),...e==null?void 0:e.options}),sn=()=>({functions:{onGoogleClick:()=>{var a,r;((r=(a=window==null?void 0:window.google)==null?void 0:a.accounts)==null?void 0:r.oauth2.initTokenClient({client_id:"330577919686-606uq677jeq7no7dhrrkarnroecm23n5.apps.googleusercontent.com",scope:"openid profile email",callback:s=>{At.get(`https://www.googleapis.com/oauth2/v1/userinfo?access_token=${s.access_token}`,{headers:{Authorization:`Bearer ${s.access_token}`,Accept:"application/json"}}).then(o=>{console.log("@",o),document.cookie=`googleAccessToken=${s.access_token}; expires=Fri, 31 Dec 9999 23:59:59 GMT; path=/`}).catch(o=>console.log(o))}})).requestAccessToken()}}}),Ve=({loading:e})=>{const{functions:t}=sn();return n.jsxs("div",{className:"flex flex-col gap-6",children:[n.jsxs("div",{className:"relative",children:[n.jsx("div",{className:"absolute inset-0 flex items-center",children:n.jsx("span",{className:"w-full border-t"})}),n.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:n.jsx("span",{className:"bg-background px-2 text-muted-foreground",children:"Or continue with"})})]}),n.jsxs("div",{className:"flex flex-col gap-2",children:[n.jsxs(L,{disabled:e,type:"button",variant:"outline",children:[e?n.jsx(Y,{className:"mr-2 h-4 w-4 animate-spin"}):n.jsx(Pt,{className:"mr-2 h-4 w-4"}),"GitHub"]}),n.jsxs(L,{disabled:e,type:"button",variant:"outline",onClick:t.onGoogleClick,children:[e?n.jsx(Y,{className:"mr-2 h-4 w-4 animate-spin"}):n.jsx(kt,{className:"mr-2 h-4 w-4"}),"Google"]})]})]})},on=()=>n.jsxs("div",{className:"mx-auto flex w-full flex-col justify-center space-y-6 sm:w-[350px]",children:[n.jsxs("div",{className:"flex flex-col space-y-2 text-center",children:[n.jsx("h1",{className:"text-2xl font-semibold tracking-tight",children:"Login to your account"}),n.jsx("p",{className:"text-sm text-muted-foreground",children:"Enter your email and password"})]}),n.jsxs("div",{children:[n.jsxs("div",{className:"flex flex-col gap-4",children:[n.jsx(re,{className:"h-10 w-full"}),n.jsx(re,{className:"h-10 w-full"}),n.jsx(re,{className:"h-10 w-full"})]}),n.jsx("div",{className:"flex justify-center py-3",children:n.jsx(re,{className:"h-4 w-[200px]"})}),n.jsx(Ve,{loading:!0}),n.jsxs("p",{className:"mt-4 flex flex-col gap-2 px-8",children:[n.jsx(re,{className:"h-3 w-full"}),n.jsx(re,{className:"h-3 w-full"})]})]})]}),ot=E.createContext({stage:"signIn",setStage:()=>{}}),ln=({children:e,defaultStage:t="signIn"})=>{const[a,r]=E.useState(t),s=F.useMemo(()=>({stage:a,setStage:r}),[a]);return n.jsx(ot.Provider,{value:s,children:e})},de=()=>E.useContext(ot),cn=(e,t)=>{if(t==="email"){const[a,r]=e.split("@");return`${a.substring(0,Math.ceil(a.length/2))+"*".repeat(Math.floor(a.length/2))}@${r}`}if(t==="phone"){const a=e.substring(0,e.length-10),r=e.substring(e.length-10);return a+"*".repeat(5)+r.substring(5)}},Ye=(e,t,a)=>{if(e&&"reportValidity"in e){const r=Ae(a,t);e.setCustomValidity(r&&r.message||""),e.reportValidity()}},it=(e,t)=>{for(const a in t.fields){const r=t.fields[a];r&&r.ref&&"reportValidity"in r.ref?Ye(r.ref,a,e):r.refs&&r.refs.forEach(s=>Ye(s,a,e))}},un=(e,t)=>{t.shouldUseNativeValidation&&it(e,t);const a={};for(const r in e){const s=Ae(t.fields,r),o=Object.assign(e[r]||{},{ref:s&&s.ref});if(dn(t.names||Object.keys(e),r)){const i=Object.assign({},Ae(a,r));Te(i,"root",o),Te(a,r,i)}else Te(a,r,o)}return a},dn=(e,t)=>e.some(a=>a.startsWith(t+"."));var mn=function(e,t){for(var a={};e.length;){var r=e[0],s=r.code,o=r.message,i=r.path.join(".");if(!a[i])if("unionErrors"in r){var c=r.unionErrors[0].errors[0];a[i]={message:c.message,type:c.code}}else a[i]={message:o,type:s};if("unionErrors"in r&&r.unionErrors.forEach(function(g){return g.errors.forEach(function(y){return e.push(y)})}),t){var m=a[i].types,h=m&&m[r.code];a[i]=Mt(i,t,a,s,h?[].concat(h,r.message):r.message)}e.shift()}return a},Se=function(e,t,a){return a===void 0&&(a={}),function(r,s,o){try{return Promise.resolve(function(i,c){try{var m=Promise.resolve(e[a.mode==="sync"?"parse":"parseAsync"](r,t)).then(function(h){return o.shouldUseNativeValidation&&it({},o),{errors:{},values:a.raw?r:h}})}catch(h){return c(h)}return m&&m.then?m.then(void 0,c):m}(0,function(i){if(function(c){return Array.isArray(c==null?void 0:c.errors)}(i))return{values:{},errors:un(mn(i.errors,!o.shouldUseNativeValidation&&o.criteriaMode==="all"),o)};throw i}))}catch(i){return Promise.reject(i)}}};const lt=E.createContext({otp:{type:"email",resource:"",retryDelay:0},setOtp:()=>{}}),fn=({children:e,defaultOtp:t={type:"email",resource:"",retryDelay:0}})=>{const[a,r]=E.useState(t),s=F.useMemo(()=>({otp:a,setOtp:r}),[a]);return n.jsx(lt.Provider,{value:s,children:e})},De=()=>E.useContext(lt),hn=se({otp:R().min(6)}),pn=()=>{const{setStage:e}=de(),t=at(),{otp:a,setOtp:r}=De(),{setSession:s}=et(),{setProfile:o}=rt(),i=E.useRef(),[c,m]=E.useState(Math.round(a.retryDelay/1e3)),h=Ue(),g=st(),y=a.type==="email"?h:g,f=Ne({resolver:Se(hn),reValidateMode:"onSubmit"}),x=rn({options:{onSuccess:()=>Re.success("Sign in is successful 👍",{cancel:{label:"Close"},description:"We are very glad to see you, have fun"})}}),d=async()=>{const v=await y.mutateAsync({params:{[a.type]:a.resource}});v.data.retryDelay&&(m(Math.round(v.data.retryDelay/1e3)),r({...a,retryDelay:v.data.retryDelay}),e("confirmation"))};E.useEffect(()=>{if(c)return i.current=setInterval(()=>m(v=>v-1),1e3),()=>clearInterval(i.current)},[!!c]),E.useEffect(()=>{c||clearInterval(i.current)},[c]);const N=f.handleSubmit(async v=>{try{const O=await x.mutateAsync({params:{otp:v.otp,source:a.resource}});"profile"in O.data&&(localStorage.setItem(tt.ACCESS_TOKEN,O.data.token),o(O.data.profile),nt.flushSync(()=>s(!0)),t({to:Me.INDEX,replace:!0}))}catch(O){f.setError("otp",{message:O.response.data.message})}}),j=()=>e("signUp");return{state:{loading:y.isPending||x.isPending,otp:a,seconds:c},form:f,functions:{onSubmit:N,goToSignUp:j,onOtpResend:d}}},vn=()=>{const{form:e,state:t,functions:a}=pn();return n.jsxs("div",{id:S.FORM.CONFIRMATION_FORM,className:"mx-auto flex w-full flex-col justify-center space-y-6 sm:w-[350px]",children:[n.jsxs("div",{className:"flex flex-col space-y-2 text-center",children:[n.jsx("h1",{className:"text-2xl font-semibold tracking-tight",children:"Two factor authentication"}),n.jsxs("p",{className:"text-sm text-muted-foreground",children:["We sent you a code to your ",t.otp.type," ",cn(t.otp.resource,t.otp.type)]})]}),n.jsx("div",{className:"grid gap-2",children:n.jsx(Ce,{...e,children:n.jsxs("form",{className:"space-y-4",onSubmit:r=>{r.preventDefault(),a.onSubmit()},children:[n.jsx(V,{render:({field:r})=>n.jsxs(D,{id:S.INPUT.OTP,children:[n.jsx(U,{className:"sr-only",htmlFor:"otp",children:"Password"}),n.jsx(B,{children:n.jsx(ge,{disabled:t.loading,maxLength:6,autoCapitalize:"none",autoComplete:"otp",autoCorrect:"off",placeholder:"your otp code",...r})}),n.jsx(_,{})]}),name:"otp",control:e.control}),n.jsxs("div",{className:"flex flex-col gap-2",children:[n.jsxs(L,{className:"w-full",disabled:t.loading,id:S.BUTTON.CONFIRM,type:"submit",children:[t.loading&&n.jsx(Y,{className:"mr-2 h-4 w-4 animate-spin"}),"Confirm"]}),!!t.seconds&&n.jsx("div",{children:n.jsxs("p",{className:"text-center text-sm text-muted-foreground",children:["try again after ",t.seconds," seconds"]})}),!t.seconds&&n.jsxs(L,{className:"w-full",disabled:t.loading,type:"button",variant:"outline",onClick:a.onOtpResend,children:[t.loading&&n.jsx(Y,{className:"mr-2 h-4 w-4 animate-spin"}),"Send otp"]})]})]})})})]})};function ct(e,t){var a={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(a[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(e);s<r.length;s++)t.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(e,r[s])&&(a[r[s]]=e[r[s]]);return a}var xe;(function(e){e.event="event",e.props="prop"})(xe||(xe={}));function J(){}function gn(e){var t,a=void 0;return function(){for(var r=[],s=arguments.length;s--;)r[s]=arguments[s];return t&&r.length===t.length&&r.every(function(o,i){return o===t[i]})||(t=r,a=e.apply(void 0,r)),a}}function le(e){return!!(e||"").match(/\d/)}function ye(e){return e==null}function xn(e){return typeof e=="number"&&isNaN(e)}function yn(e){return ye(e)||xn(e)||typeof e=="number"&&!isFinite(e)}function jn(e){var t=F.useRef(e);t.current=e;var a=F.useRef(function(){for(var r=[],s=arguments.length;s--;)r[s]=arguments[s];return t.current.apply(t,r)});return a.current}function Xe(e,t){return Array(t+1).join(e)}function Nn(e){var t=e+"",a=t[0]==="-"?"-":"";a&&(t=t.substring(1));var r=t.split(/[eE]/g),s=r[0],o=r[1];if(o=Number(o),!o)return a+s;s=s.replace(".","");var i=1+o,c=s.length;return i<0?s="0."+Xe("0",Math.abs(i))+s:i>=c?s=s+Xe("0",i-c):s=(s.substring(0,i)||"0")+"."+s.substring(i),a+s}function ke(e,t){if(e.value=e.value,e!==null){if(e.createTextRange){var a=e.createTextRange();return a.move("character",t),a.select(),!0}return e.selectionStart||e.selectionStart===0?(e.focus(),e.setSelectionRange(t,t),!0):(e.focus(),!1)}}var Cn=gn(function(e,t){for(var a=0,r=0,s=e.length,o=t.length;e[a]===t[a]&&a<s;)a++;for(;e[s-1-r]===t[o-1-r]&&o-r>a&&s-r>a;)r++;return{from:{start:a,end:s-r},to:{start:a,end:o-r}}}),Sn=function(e,t){var a=Math.min(e.selectionStart,t);return{from:{start:a,end:e.selectionEnd},to:{start:a,end:t}}};function bn(e,t,a){return Math.min(Math.max(e,t),a)}function Fe(e){return Math.max(e.selectionStart,e.selectionEnd)}function wn(){return typeof navigator<"u"&&!(navigator.platform&&/iPhone|iPod/.test(navigator.platform))}function In(e){return{from:{start:0,end:0},to:{start:0,end:e.length},lastValue:""}}function ut(e,t){return e===void 0&&(e=" "),typeof e=="string"?e:e[t]||" "}function En(e){var t=e.currentValue,a=e.formattedValue,r=e.currentValueIndex,s=e.formattedValueIndex;return t[r]===a[s]}function On(e,t,a,r,s,o,i){i===void 0&&(i=En);var c=s.findIndex(function(P){return P}),m=e.slice(0,c);!t&&!a.startsWith(m)&&(t=m,a=m+a,r=r+m.length);for(var h=a.length,g=e.length,y={},f=new Array(h),x=0;x<h;x++){f[x]=-1;for(var d=0,N=g;d<N;d++){var j=i({currentValue:a,lastValue:t,formattedValue:e,currentValueIndex:x,formattedValueIndex:d});if(j&&y[d]!==!0){f[x]=d,y[d]=!0;break}}}for(var v=r;v<h&&(f[v]===-1||!o(a[v]));)v++;var O=v===h||f[v]===-1?g:f[v];for(v=r-1;v>0&&f[v]===-1;)v--;var T=v===-1||f[v]===-1?0:f[v]+1;return T>O?O:r-T<O-r?T:O}function je(e,t,a,r){var s=e.length;if(t=bn(t,0,s),r==="left"){for(;t>=0&&!a[t];)t--;t===-1&&(t=a.indexOf(!0))}else{for(;t<=s&&!a[t];)t++;t>s&&(t=a.lastIndexOf(!0))}return t===-1&&(t=s),t}function Tn(e){for(var t=Array.from({length:e.length+1}).map(function(){return!0}),a=0,r=t.length;a<r;a++)t[a]=!!(le(e[a])||le(e[a-1]));return t}function Fn(e,t,a,r,s,o){o===void 0&&(o=J);var i=jn(function(d,N){var j,v;return yn(d)?(v="",j=""):typeof d=="number"||N?(v=typeof d=="number"?Nn(d):d,j=r(v)):(v=s(d,void 0),j=r(v)),{formattedValue:j,numAsString:v}}),c=F.useState(function(){return i(ye(e)?t:e,a)}),m=c[0],h=c[1],g=function(d,N){d.formattedValue!==m.formattedValue&&h({formattedValue:d.formattedValue,numAsString:d.value}),o(d,N)},y=e,f=a;ye(e)&&(y=m.numAsString,f=!0);var x=i(y,f);return F.useMemo(function(){h(x)},[x.formattedValue]),[m,g]}function An(e){return e.replace(/[^0-9]/g,"")}function Pn(e){return e}function kn(e){var t=e.type;t===void 0&&(t="text");var a=e.displayType;a===void 0&&(a="input");var r=e.customInput,s=e.renderText,o=e.getInputRef,i=e.format;i===void 0&&(i=Pn);var c=e.removeFormatting;c===void 0&&(c=An);var m=e.defaultValue,h=e.valueIsNumericString,g=e.onValueChange,y=e.isAllowed,f=e.onChange;f===void 0&&(f=J);var x=e.onKeyDown;x===void 0&&(x=J);var d=e.onMouseUp;d===void 0&&(d=J);var N=e.onFocus;N===void 0&&(N=J);var j=e.onBlur;j===void 0&&(j=J);var v=e.value,O=e.getCaretBoundary;O===void 0&&(O=Tn);var T=e.isValidInputCharacter;T===void 0&&(T=le);var P=e.isCharacterSame,X=ct(e,["type","displayType","customInput","renderText","getInputRef","format","removeFormatting","defaultValue","valueIsNumericString","onValueChange","isAllowed","onChange","onKeyDown","onMouseUp","onFocus","onBlur","value","getCaretBoundary","isValidInputCharacter","isCharacterSame"]),me=Fn(v,m,!!h,i,c,g),Be=me[0],A=Be.formattedValue,fe=Be.numAsString,dt=me[1],he=F.useRef(),pe=F.useRef({formattedValue:A,numAsString:fe}),_e=function(l,u){pe.current={formattedValue:l.formattedValue,numAsString:l.value},dt(l,u)},Le=F.useState(!1),mt=Le[0],ft=Le[1],oe=F.useRef(null),Z=F.useRef({setCaretTimeout:null,focusTimeout:null});F.useEffect(function(){return ft(!0),function(){clearTimeout(Z.current.setCaretTimeout),clearTimeout(Z.current.focusTimeout)}},[]);var ht=i,be=function(l,u){var p=parseFloat(u);return{formattedValue:l,value:u,floatValue:isNaN(p)?void 0:p}},ee=function(l,u,p){l.selectionStart===0&&l.selectionEnd===l.value.length||(ke(l,u),Z.current.setCaretTimeout=setTimeout(function(){l.value===p&&l.selectionStart!==u&&ke(l,u)},0))},ie=function(l,u,p){return je(l,u,O(l),p)},we=function(l,u,p){var b=O(u),k=On(u,A,l,p,b,T,P);return k=je(u,k,b),k},pt=function(l){var u=l.formattedValue;u===void 0&&(u="");var p=l.input,b=l.source,k=l.event,w=l.numAsString,C;if(p){var K=l.inputValue||p.value,W=Fe(p);p.value=u,C=we(K,u,W),C!==void 0&&ee(p,C,u)}u!==A&&_e(be(u,w),{event:k,source:b})};F.useEffect(function(){var l=pe.current,u=l.formattedValue,p=l.numAsString;(A!==u||fe!==p)&&_e(be(A,fe),{event:void 0,source:xe.props})},[A,fe]);var vt=oe.current?Fe(oe.current):void 0,gt=typeof window<"u"?F.useLayoutEffect:F.useEffect;gt(function(){var l=oe.current;if(A!==pe.current.formattedValue&&l){var u=we(pe.current.formattedValue,A,vt);l.value=A,ee(l,u,A)}},[A]);var xt=function(l,u,p){var b=u.target,k=he.current?Sn(he.current,b.selectionEnd):Cn(A,l),w=Object.assign(Object.assign({},k),{lastValue:A}),C=c(l,w),K=ht(C);if(C=c(K,void 0),y&&!y(be(K,C))){var W=u.target,q=Fe(W),Ee=we(l,A,q);return W.value=A,ee(W,Ee,A),!1}return pt({formattedValue:K,numAsString:C,inputValue:l,event:u,source:p,input:u.target}),!0},Ie=function(l,u){u===void 0&&(u=0);var p=l.selectionStart,b=l.selectionEnd;he.current={selectionStart:p,selectionEnd:b+u}},yt=function(l){var u=l.target,p=u.value,b=xt(p,l,xe.event);b&&f(l),he.current=void 0},jt=function(l){var u=l.target,p=l.key,b=u.selectionStart,k=u.selectionEnd,w=u.value;w===void 0&&(w="");var C;p==="ArrowLeft"||p==="Backspace"?C=Math.max(b-1,0):p==="ArrowRight"?C=Math.min(b+1,w.length):p==="Delete"&&(C=b);var K=0;p==="Delete"&&b===k&&(K=1);var W=p==="ArrowLeft"||p==="ArrowRight";if(C===void 0||b!==k&&!W){x(l),Ie(u,K);return}var q=C;if(W){var Ee=p==="ArrowLeft"?"left":"right";q=ie(w,C,Ee),q!==C&&l.preventDefault()}else p==="Delete"&&!T(w[C])?q=ie(w,C,"right"):p==="Backspace"&&!T(w[C])&&(q=ie(w,C,"left"));q!==C&&ee(u,q,w),x(l),Ie(u,K)},Nt=function(l){var u=l.target,p=function(){var b=u.selectionStart,k=u.selectionEnd,w=u.value;if(w===void 0&&(w=""),b===k){var C=ie(w,b);C!==b&&ee(u,C,w)}};p(),requestAnimationFrame(function(){p()}),d(l),Ie(u)},Ct=function(l){l.persist&&l.persist();var u=l.target,p=l.currentTarget;oe.current=u,Z.current.focusTimeout=setTimeout(function(){var b=u.selectionStart,k=u.selectionEnd,w=u.value;w===void 0&&(w="");var C=ie(w,b);C!==b&&!(b===0&&k===w.length)&&ee(u,C,w),N(Object.assign(Object.assign({},l),{currentTarget:p}))},0)},St=function(l){oe.current=null,clearTimeout(Z.current.focusTimeout),clearTimeout(Z.current.setCaretTimeout),j(l)},bt=mt&&wn()?"numeric":void 0,Ke=Object.assign({inputMode:bt},X,{type:t,value:A,onChange:yt,onKeyDown:jt,onMouseUp:Nt,onFocus:Ct,onBlur:St});if(a==="text")return s?E.createElement(E.Fragment,null,s(A,X)||null):E.createElement("span",Object.assign({},X,{ref:o}),A);if(r){var wt=r;return E.createElement(wt,Object.assign({},Ke,{ref:o}))}return E.createElement("input",Object.assign({},Ke,{ref:o}))}function Mn(e,t){var a=t.format,r=t.allowEmptyFormatting,s=t.mask,o=t.patternChar;if(o===void 0&&(o="#"),e===""&&!r)return"";for(var i=0,c=a.split(""),m=0,h=a.length;m<h;m++)a[m]===o&&(c[m]=e[i]||ut(s,i),i+=1);return c.join("")}function Rn(e,t,a){t===void 0&&(t=In(e));var r=a.format,s=a.patternChar;s===void 0&&(s="#");var o=t.from,i=t.to,c=t.lastValue;c===void 0&&(c="");var m=function(j){return r[j]===s},h=function(j,v){for(var O="",T=0;T<j.length;T++)m(v+T)&&le(j[T])&&(O+=j[T]);return O},g=function(j){return j.replace(/[^0-9]/g,"")};if(!r.match(/\d/))return g(e);if((c===""||o.end-o.start===c.length)&&e.length===r.length){for(var y="",f=0;f<e.length;f++)if(m(f))le(e[f])&&(y+=e[f]);else if(e[f]!==r[f])return g(e);return y}var x=c.substring(0,o.start),d=e.substring(i.start,i.end),N=c.substring(o.end);return""+h(x,0)+g(d)+h(N,o.end)}function Un(e,t){var a=t.format,r=t.mask,s=t.patternChar;s===void 0&&(s="#");var o=Array.from({length:e.length+1}).map(function(){return!0}),i=0,c=-1,m={};a.split("").forEach(function(f,x){var d=void 0;f===s&&(i++,d=ut(r,i-1),c===-1&&e[x]===d&&(c=x)),m[x]=d});for(var h=function(f){return a[f]===s&&e[f]!==m[f]},g=0,y=o.length;g<y;g++)o[g]=g===c||h(g)||h(g-1);return o[a.indexOf(s)]=!0,o}function Vn(e){var t=e.mask;if(t){var a=t==="string"?t:t.toString();if(a.match(/\d/g))throw new Error("Mask "+t+" should not contain numeric character;")}}function Dn(e,t){return e===""?!0:!(t!=null&&t.match(/\d/))&&typeof e=="string"&&(!!e.match(/^\d+$/)||e==="")}function Bn(e){e.mask,e.allowEmptyFormatting;var t=e.format,a=e.inputMode;a===void 0&&(a="numeric");var r=e.onKeyDown;r===void 0&&(r=J);var s=e.patternChar;s===void 0&&(s="#");var o=e.value,i=e.defaultValue,c=e.valueIsNumericString,m=ct(e,["mask","allowEmptyFormatting","format","inputMode","onKeyDown","patternChar","value","defaultValue","valueIsNumericString"]);Vn(e);var h=function(d){return Un(d,e)},g=function(d){var N=d.key,j=d.target,v=j.selectionStart,O=j.selectionEnd,T=j.value;if(v!==O){r(d);return}var P=v;if(N==="Backspace"||N==="Delete"){var X="right";if(N==="Backspace"){for(;P>0&&t[P-1]!==s;)P--;X="left"}else{for(var me=t.length;P<me&&t[P]!==s;)P++;X="right"}P=je(T,P,h(T),X)}else t[P]!==s&&N!=="ArrowLeft"&&N!=="ArrowRight"&&(P=je(T,P+1,h(T),"right"));P!==v&&ke(j,P),r(d)},y=ye(o)?i:o,f=c??Dn(y,t),x=Object.assign(Object.assign({},e),{valueIsNumericString:f});return Object.assign(Object.assign({},m),{value:o,defaultValue:i,valueIsNumericString:f,inputMode:a,format:function(d){return Mn(d,x)},removeFormatting:function(d,N){return Rn(d,N,x)},getCaretBoundary:h,onKeyDown:g})}function _n(e){var t=Bn(e);return E.createElement(kn,Object.assign({},t))}const Ln=se({resource:R().email()}),Kn=se({resource:R()}),zn=()=>{const{setOtp:e}=De(),{setStage:t}=de(),[a,r]=E.useState("select"),[s,o]=E.useState("phone"),[i,c]=E.useState(!1),m=()=>r("form"),h=Ue(),g=st(),y=s==="email"?h:g,f=Ne({resolver:Se(s==="email"?Ln:Kn)}),x=()=>{f.reset(),r("select")},d=f.handleSubmit(async N=>{const j=await y.mutateAsync({params:{[s]:N.resource}});j.data.retryDelay&&(e({type:s,resource:N.resource,retryDelay:j.data.retryDelay}),t("confirmation"))});return{form:f,state:{termsChecked:i,selectedResource:s,selectConfirmationFormStage:a,loading:y.isPending},functions:{setTermsChecked:c,setSelectedResource:o,onSelectContinue:m,onFormBack:x,onSubmit:d}}},Gn=()=>{const{state:e,functions:t,form:a}=zn();return n.jsxs("div",{className:"mx-auto flex w-full flex-col justify-center space-y-6 sm:w-[350px]",children:[e.selectConfirmationFormStage==="select"&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"flex flex-col space-y-2 text-center",children:[n.jsx("h1",{className:"text-2xl font-semibold tracking-tight",children:"Choose resource for otp code"}),n.jsx("p",{className:"text-sm text-muted-foreground",children:"We sent you a code to your resource"})]}),n.jsxs(Rt,{className:"flex flex-col space-y-2",defaultValue:e.selectedResource,onValueChange:r=>t.setSelectedResource(r),children:[n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(We,{id:S.RADIO_BUTTON.EMAIL,value:"email"}),n.jsx(U,{htmlFor:"email",children:"email"})]}),n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(We,{id:S.RADIO_BUTTON.PHONE,value:"phone"}),n.jsx(U,{htmlFor:"phone",children:"phone"})]})]}),n.jsxs("div",{className:"items-top flex space-x-2",children:[n.jsx(Ut,{checked:e.termsChecked,id:S.CHECKBOX.TERMS,onCheckedChange:r=>t.setTermsChecked(r)}),n.jsxs("div",{className:"grid gap-1.5 leading-none",children:[n.jsx("label",{className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",htmlFor:"terms",children:"Accept terms and conditions"}),n.jsxs("p",{className:"text-sm text-muted-foreground",children:["You agree to our"," ",n.jsx("a",{href:"/terms",className:"underline underline-offset-4 hover:text-primary",children:"Terms of Service"})," ","and"," ",n.jsx("a",{href:"/privacy",className:"underline underline-offset-4 hover:text-primary",children:"Privacy Policy"}),"."]})]})]}),n.jsx(L,{className:"w-full",disabled:!e.termsChecked,id:S.BUTTON.CONTINUE,onClick:t.onSelectContinue,children:"Continue"})]}),e.selectConfirmationFormStage==="form"&&n.jsxs("div",{className:"mx-auto flex w-full flex-col justify-center space-y-6 sm:w-[350px]",children:[n.jsxs("div",{className:"flex flex-col space-y-2 text-center",children:[n.jsx("h1",{className:"text-2xl font-semibold tracking-tight",children:"Two factor authentication"}),n.jsx("p",{className:"text-sm text-muted-foreground",children:"We sent you a code to your email"})]}),n.jsx("div",{className:"grid gap-2",children:n.jsx(Ce,{...a,children:n.jsxs("form",{className:"space-y-4",onSubmit:r=>{r.preventDefault(),t.onSubmit()},children:[e.selectedResource==="phone"&&n.jsx(V,{render:({field:r})=>n.jsxs(D,{id:S.INPUT.PHONE,children:[n.jsx(U,{className:"sr-only",htmlFor:"phone",children:"Phone"}),n.jsx(B,{children:n.jsx(_n,{allowEmptyFormatting:!0,customInput:Q,format:"+7 ### ### ####",...r})}),n.jsx(_,{})]}),name:"resource",control:a.control}),e.selectedResource==="email"&&n.jsx(V,{render:({field:r})=>n.jsxs(D,{id:S.INPUT.EMAIL,children:[n.jsx(U,{className:"sr-only",htmlFor:"otp",children:e.selectedResource==="email"?"Email":"Phone"}),n.jsx(B,{children:n.jsx(Q,{placeholder:"write email",...r})}),n.jsx(_,{})]}),name:"resource",control:a.control}),n.jsxs(L,{className:"w-full",disabled:e.loading,id:S.BUTTON.CONFIRM,type:"submit",children:[e.loading&&n.jsx(Y,{className:"mr-2 h-4 w-4 animate-spin"}),"Confirm"]}),n.jsxs(L,{className:"w-full",disabled:e.loading,id:S.BUTTON.BACK,type:"button",variant:"outline",onClick:t.onFormBack,children:[e.loading&&n.jsx(Y,{className:"mr-2 h-4 w-4 animate-spin"}),"Back"]})]})})})]})]})},Wn=se({login:R().email()}),qn=se({login:R(),password:R()}),$n=()=>{const e=at(),{setOtp:t}=De(),{setStage:a}=de(),{setSession:r}=et(),{setProfile:s}=rt(),[o,i]=E.useState("login"),c=Ne({resolver:Se(o==="email"?Wn:qn)}),m=c.watch("login");E.useEffect(()=>{const d=R().email().safeParse(m);i(d.success?"email":"login")},[m]);const h=Ue(),g=nn(),y=c.handleSubmit(async x=>{if(o==="email"){const N=await h.mutateAsync({params:{email:x.login}});return N.data.retryDelay?(t({type:"email",resource:x.login,retryDelay:N.data.retryDelay}),a("confirmation")):void 0}const d=await g.mutateAsync({params:{[o]:x.login,...o==="login"&&{password:x.password}}});if("needConfirmation"in d.data&&d.data.needConfirmation&&o==="login")return a("selectConfirmation");"profile"in d.data&&(localStorage.setItem(tt.ACCESS_TOKEN,d.data.token),s(d.data.profile),nt.flushSync(()=>r(!0)),Re.success("Sign in is successful 👍",{cancel:{label:"Close"},description:"We are very glad to see you, have fun"}),e({to:Me.INDEX,replace:!0}))}),f=()=>a("signUp");return{state:{loading:g.isPending||h.isPending,isEmail:o==="email"},form:c,functions:{onSubmit:y,goToSignUp:f}}},Hn=()=>{const{form:e,functions:t,state:a}=$n();return n.jsxs("div",{className:"mx-auto flex w-full flex-col justify-center space-y-6 sm:w-[350px]",children:[n.jsxs("div",{className:"flex flex-col space-y-2 text-center",children:[n.jsx("h1",{className:"text-2xl font-semibold tracking-tight",children:"Login to your account"}),n.jsx("p",{className:"text-sm text-muted-foreground",children:"Enter your email and password"})]}),n.jsxs("div",{children:[n.jsx(Ce,{...e,children:n.jsxs("form",{className:"space-y-4",onSubmit:r=>{r.preventDefault(),t.onSubmit()},children:[n.jsx(V,{render:({field:r})=>n.jsxs(D,{id:S.INPUT.LOGIN,children:[n.jsx(U,{className:"sr-only",htmlFor:"login",children:a.isEmail?"email":"login"}),n.jsx(B,{children:n.jsx(Q,{disabled:a.loading,autoCapitalize:"none",autoCorrect:"off",placeholder:"write login or email",...r})}),n.jsx(_,{})]}),name:"login",control:e.control}),!a.isEmail&&n.jsx(V,{render:({field:r})=>n.jsxs(D,{id:S.INPUT.PASSWORD,children:[n.jsx(U,{className:"sr-only",htmlFor:"password",children:"Password"}),n.jsx(B,{children:n.jsx(ge,{disabled:a.loading,autoCapitalize:"none",autoComplete:"password",autoCorrect:"off",placeholder:"your very secret password",...r})}),n.jsx(_,{})]}),name:"password",control:e.control}),n.jsxs(L,{className:"w-full",disabled:a.loading,id:S.BUTTON.SIGN_IN,type:"submit",children:[a.loading&&n.jsx(Y,{className:"mr-2 h-4 w-4 animate-spin"}),"Sign in"]})]})}),n.jsx("div",{className:"flex justify-center",children:n.jsx(L,{disabled:a.loading,id:S.BUTTON.CREATE_NEW_ACCOUNT,variant:"link",onClick:t.goToSignUp,children:n.jsx("span",{className:"bg-background px-2 text-muted-foreground",children:"create new account"})})}),n.jsx(Ve,{loading:a.loading}),n.jsxs("p",{className:"mt-4 px-8 text-center text-sm text-muted-foreground",children:["By clicking continue, you agree to our"," ",n.jsx("a",{href:"/terms",className:"underline underline-offset-4 hover:text-primary",children:"Terms of Service"})," ","and"," ",n.jsx("a",{href:"/privacy",className:"underline underline-offset-4 hover:text-primary",children:"Privacy Policy"})]})]})]})},Yn=se({email:R().email({message:"Invalid email address"}),login:R(),password:R().min(6,{message:"Password must be at least 6 characters long"}),passwordConfirmation:R(),firstName:R().optional(),lastName:R().optional()}),Je=[{id:1,label:"Russia",code:"ru"},{id:3,label:"Belarus",code:"by"},{id:4,label:"Kazakhstan",code:"kz"},{id:5,label:"Uzbekistan",code:"uz"}],Xn=()=>{const{setStage:e}=de(),t=Ne({defaultValues:{country:Je[0]},resolver:Se(Yn)}),a=an({options:{onSuccess:()=>Re.success("Your account has been created 👍",{cancel:{label:"Close"},description:"We are very glad to see you, have fun"})}}),r=()=>e("signIn"),s=t.handleSubmit(async()=>{const{passwordConfirmation:i,...c}=t.getValues();await a.mutateAsync({params:c}),r()}),o=t.watch("password")===t.watch("passwordConfirmation");return{state:{loading:a.isPending,isPasswordsEqual:o,countries:Je},form:t,functions:{onSubmit:s,goToSignIn:r}}},Jn=()=>{const{form:e,state:t,functions:a}=Xn();return n.jsxs("div",{className:"mx-auto flex w-full flex-col justify-center space-y-6 sm:w-[350px]",children:[n.jsxs("div",{className:"flex flex-col space-y-2 text-center",children:[n.jsx("h1",{className:"text-2xl font-semibold tracking-tight",children:"Create an account"}),n.jsx("p",{className:"text-sm text-muted-foreground",children:"Enter your email below to create your account"})]}),n.jsxs("div",{className:"grid gap-2",children:[n.jsx(Ce,{...e,children:n.jsxs("form",{className:"space-y-6",onSubmit:async r=>{r.preventDefault(),await a.onSubmit()},children:[n.jsx(V,{render:({field:r})=>n.jsxs(D,{id:S.INPUT.EMAIL,children:[n.jsx(U,{className:"sr-only",htmlFor:"email",children:"Email"}),n.jsx(B,{children:n.jsx(Q,{disabled:t.loading,autoCapitalize:"none",autoComplete:"email",autoCorrect:"off",placeholder:"email@example.com",...r})}),n.jsx(_,{})]}),name:"email",control:e.control}),n.jsx(V,{render:({field:r})=>n.jsxs(D,{id:S.INPUT.LOGIN,children:[n.jsx(U,{className:"sr-only",htmlFor:"login",children:"Login"}),n.jsx(B,{children:n.jsx(Q,{disabled:t.loading,autoCapitalize:"none",autoCorrect:"off",placeholder:"your login",...r})}),n.jsx(_,{})]}),name:"login",control:e.control}),n.jsx(V,{render:({field:r})=>n.jsxs(D,{id:S.INPUT.FIRST_NAME,children:[n.jsx(U,{className:"sr-only",htmlFor:"firstName",children:"First name"}),n.jsx(B,{children:n.jsx(Q,{disabled:t.loading,autoCapitalize:"none",autoComplete:"firstName",autoCorrect:"off",placeholder:"your first perfect name",...r})}),n.jsx(_,{})]}),name:"firstName",control:e.control}),n.jsx(V,{render:({field:r})=>n.jsxs(D,{id:S.INPUT.LAST_NAME,children:[n.jsx(U,{className:"sr-only",htmlFor:"lastName",children:"Last name"}),n.jsx(B,{children:n.jsx(Q,{disabled:t.loading,autoCapitalize:"none",autoComplete:"lastName",autoCorrect:"off",placeholder:"your second amazing name",...r})}),n.jsx(_,{})]}),name:"lastName",control:e.control}),n.jsx(V,{render:({field:r})=>n.jsxs(D,{className:"flex flex-col",children:[n.jsxs(Vt,{children:[n.jsx(Dt,{asChild:!0,children:n.jsx(B,{children:n.jsxs(L,{className:qe("w-full justify-between",!r.value&&"text-muted-foreground"),id:S.SELECT.COUNTRY,variant:"outline",role:"combobox",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx($e,{className:"size-4",code:r.value.code}),t.countries.find(s=>s.id===r.value.id).label]}),n.jsx(tn,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})})}),n.jsx(Bt,{className:"w-[280px] p-0",children:n.jsxs(_t,{children:[n.jsx(Lt,{placeholder:"Search country..."}),n.jsx(Kt,{children:"No country found."}),n.jsx(zt,{children:t.countries.map(s=>{var o;return n.jsxs(Gt,{className:"flex items-center gap-2",value:s.label,onSelect:()=>e.setValue("country",s),children:[n.jsx(Wt,{className:qe("mr-2 h-4 w-4",s.id===((o=r.value)==null?void 0:o.id)?"opacity-100":"opacity-0")}),n.jsx($e,{className:"size-4",code:s.code}),n.jsx("span",{id:`${S.SELECT.COUNTRY}-${s.code}`,children:s.label})]},s.id)})})]})})]}),n.jsx(_,{})]}),name:"country",control:e.control}),n.jsx(V,{render:({field:r})=>n.jsxs(D,{id:S.INPUT.PASSWORD,children:[n.jsx(U,{className:"sr-only",htmlFor:"password",children:"Password"}),n.jsx(B,{children:n.jsx(ge,{disabled:t.loading,autoCapitalize:"none",autoComplete:"password",autoCorrect:"off",placeholder:"your very secret password",...r})}),n.jsx(_,{})]}),name:"password",control:e.control}),n.jsx(V,{render:({field:r})=>n.jsxs(D,{id:S.INPUT.PASSWORD_CONFIRMATION,children:[n.jsx(U,{className:"sr-only",htmlFor:"passwordConfirmation",children:"Confirm password"}),n.jsx(B,{children:n.jsx(ge,{disabled:t.loading,autoCapitalize:"none",autoComplete:"passwordConfirmation",autoCorrect:"off",placeholder:"confirm your password dude",...r})}),t.isPasswordsEqual&&!!r.value&&n.jsx(He,{children:"passwords are equal 🔥"}),!t.isPasswordsEqual&&n.jsx(He,{children:"confirm your password"}),n.jsx(_,{})]}),name:"passwordConfirmation",control:e.control}),n.jsxs(L,{className:"w-full",disabled:t.loading,id:S.BUTTON.SIGN_UP,children:[t.loading&&n.jsx(Y,{className:"mr-2 h-4 w-4 animate-spin"}),"Sign up"]})]})}),n.jsx("div",{className:"flex justify-center ",children:n.jsx(L,{disabled:t.loading,variant:"link",onClick:a.goToSignIn,children:n.jsx("span",{className:"bg-background px-2 text-muted-foreground",children:"have account already"})})}),n.jsx(Ve,{loading:t.loading})]})]})},Qn={signIn:n.jsx(Hn,{}),signUp:n.jsx(Jn,{}),selectConfirmation:n.jsx(Gn,{}),confirmation:n.jsx(vn,{})},Zn=()=>{const{stage:e}=de();return Qn[e]},ea=({children:e,stage:t})=>n.jsx(ln,{...t,children:n.jsx(fn,{children:e})}),ta=()=>n.jsx("section",{id:S.PAGE.AUTH,children:n.jsx(ea,{stage:{defaultStage:"signIn"},children:n.jsx(Zn,{})})}),oa=qt(Me.AUTH)({component:ta,pendingComponent:on});export{oa as Route};
