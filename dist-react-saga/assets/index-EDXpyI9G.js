import{t as l}from"./redux-saga-effects.esm-CmDjhKgN.js";import{ab as p,ac as S,ae as s,af as r,aj as f,ad as o,a8 as O,ak as h,al as C,am as b}from"./main-zFq7zC_h.js";import{o as v,a as c,s as w}from"./index-CAmX4lj4.js";const E=t=>t.auth.otp,N=t=>t.auth.stage.value,W=t=>t.auth.otpCountdown,z=t=>(console.log("@@@"),t.api.postSignInLogin.status==="pending"||t.api.postOtpEmail.status==="pending"),M=t=>t.api.postTwoFactorAuthentication.status==="pending",Y=t=>t.api.postOtpEmail.status==="pending"||t.api.postOtpPhone.status==="pending",q=t=>t.api.postSignUp.status==="pending",D=p("auth.onConfirmationSubmit");function*I(t){const{values:e,setError:a}=t.payload;try{const n=yield S(E),i=yield s(r.endpoints.postTwoFactorAuthentication.initiate,{params:{otp:e.otp,source:n.resource}});"profile"in i.data&&(yield localStorage.setItem(f.ACCESS_TOKEN,i.data.token),yield o(O.actions.setProfile(i.data.profile)),yield o(h.actions.setSession(!0)),yield C.navigate({to:"/",replace:!0}))}catch(n){a(n.response.data.message)}}const d={saga:I,action:D},$=p("auth.onOtpResend");function*L(){try{const t=yield S(E),e=t.type==="email"?r.endpoints.postOtpEmail:r.endpoints.postOtpPhone,a=yield s(e.initiate,{params:{[t.type]:t.resource}});a.data.retryDelay&&(yield s(v.startCountdown,a.data.retryDelay/1e3),yield o(c.setOtp({retryDelay:a.data.retryDelay})),yield o(c.setStage("confirmation")))}catch(t){console.error(t)}}const y={saga:L,action:$},R=p("auth.onSelectConfirmationSubmit");function*A(t){try{const{values:e,selectedResource:a}=t.payload,n=a==="email"?r.endpoints.postOtpEmail:r.endpoints.postOtpPhone,i=yield s(n.initiate,{params:{[a]:e.resource}});i.data.retryDelay&&(yield o(c.setOtp({type:a,resource:e.resource,retryDelay:i.data.retryDelay})),yield o(c.setStage("confirmation")))}catch(e){console.error(e)}}const u={saga:A,action:R},F=p("auth.onSignInSubmit");function*P(t){try{const{resource:e,values:a}=t.payload;if(e==="email"){const i=yield s(r.endpoints.postOtpEmail.initiate,{params:{email:a.login}});if(!i.data.retryDelay)return;yield o(c.setOtp({type:"email",resource:a.login,retryDelay:i.data.retryDelay})),yield s(v.startCountdown,i.data.retryDelay/1e3),yield o(c.setStage("confirmation"));return}const n=yield s(r.endpoints.postSignInLogin.initiate,{params:{[e]:a.login,...e==="login"&&{password:a.password}}});if("needConfirmation"in n.data&&n.data.needConfirmation&&e==="login"){yield o(c.setStage("selectConfirmation"));return}"profile"in n.data&&(localStorage.setItem(f.ACCESS_TOKEN,n.data.token),yield o(O.actions.setProfile(n.data.profile)),yield o(h.actions.setSession(!0)),yield b.success("Sign in is successful üëç",{cancel:{label:"Close"},description:"We are very glad to see you, have fun"}),yield C.navigate({to:"/",replace:!0}))}catch(e){console.error(e)}}const g={saga:P,action:F},T=p("auth.onSignUpSubmit");function*U(t){try{const{values:{passwordConfirmation:e,...a}}=t.payload;yield s(r.endpoints.postSignUp.initiate,{params:a}),yield b.success("Your account has been created üëç",{cancel:{label:"Close"},description:"We are very glad to see you, have fun"}),yield o(w.actions.setStage("signIn"))}catch(e){console.error(e)}}const m={saga:U,action:T};function*_(){yield l(g.action.type,g.saga),yield l(y.action.type,y.saga),yield l(d.action.type,d.saga),yield l(u.action.type,u.saga),yield l(m.action.type,m.saga)}const k={onOtpResend:y,onSignInSubmit:g,onConfirmationSubmit:d,onSelectConfirmationSubmit:u,onSignUpSubmit:m},B=Object.freeze(Object.defineProperty({__proto__:null,authSagas:k,sagas:_},Symbol.toStringTag,{value:"Module"}));export{E as a,W as b,k as c,Y as d,z as e,q as f,M as g,N as h,B as i};
